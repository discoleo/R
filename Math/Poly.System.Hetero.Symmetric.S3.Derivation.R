########################
###
### Leonard Mada
### [the one and only]
###
### Polynomial Systems: S3
### Heterogeneous Symmetric
###  == Derivation ==
###
### draft v.0.2b


###############
### History ###
###############


### draft v.0.2a:
# - started work on S3P4 Simple:
#   x^4 + b*y = R;
### draft v.0.1a:
# - cleanup;
# - moved derivation from file:
#   Poly.System.Hetero.Symmetric.S3.R
#   to this file;


####################
####################

### Helper Functions

source("Polynomials.Helper.R")
source("Polynomials.Helper.EP.R")


# library(polynom)
# library(pracma)

# the functions are in the file:
# Polynomials.Helper.R
# - e.g. round0(), round0.p(),
#   solve.EnAll(), solveEn();

### other
# ...


###################

################
###  Simple  ###
################

###############
### Order 2 ###
###############

# x^2 + b1*y = R
# y^2 + b1*z = R
# z^2 + b1*x = R


### Solution

# Trivial solution: x = y = z;

### Method 1:
### Sum =>
x^2 + y^2 + z^2 + b1*(x+y+z) - 3*R # = 0
S^2 - 2*E2 + b1*S - 3*R # = 0
# 2*E2 = S^2 + b1*S - 3*R;

### Sum(x[i]*...) =>
x^3 + y^3 + z^3 + b1*E2 - R*S # = 0
S^3 - 3*E2*S + 3*E3 + b1*E2 - R*S # = 0
2*S^3 - 6*E2*S + 6*E3 + 2*b1*E2 - 2*R*S
2*S^3 - 3*(S^2 + b1*S - 3*R)*S + 6*E3 + b1*(S^2 + b1*S - 3*R) - 2*R*S
6*E3 - S^3 - 2*b1*S^2 + 7*R*S + b1^2*S - 3*b1*R
# 6*E3 = S^3 + 2*b1*S^2 - 7*R*S - b1^2*S + 3*b1*R

### Sum(x[i+1]^2*...) =>
E2^2 - 2*E3*S + b1*(S^3 - 3*E2*S + 3*E3) - R*(S^2 - 2*E2) # = 0
(S^2 + b1*S - 3*R)^2 - 8*E3*S + b1*(4*S^3 - 6*(S^2 + b1*S - 3*R)*S + 12*E3) - 4*R*(S^2 - (S^2 + b1*S - 3*R))
(S^2 + b1*S - 3*R)^2 - 8*E3*S + b1*(-2*S^3 - 6*b1*S^2 + 22*R*S + 12*E3) - 12*R^2
S^4 - 6*R*S^2 - 5*b1^2*S^2 + 16*b1*R*S - 8*E3*S + 12*b1*E3 - 3*R^2
S^4 + 2*b1*S^3 - (10*R + b1^2)*S^2 + 6*(b1*R + b1^3)*S - 18*b1^2*R + 9*R^2

### Eq:
(S^2 + 3*b1*S - 9*R)*(S^2 - b1*S - R + 2*b1^2)


### [old]

### Diff =>
# - simplification for Order 2:
# x^2 - y^2 = b1*(z-y)
# y^2 - z^2 = b1*(x-z)
# z^2 - x^2 = b1*(y-x)
# Prod =>
# (x+y)*(x+z)*(y+z) = (-1)*b1^3;
# S^3 - (x^3 + y^3 + z^3) + 3*b1^3 = 0;

# [Prod] =>
# (x^2 + x*y + x*z + y*z)*(y+z) = - b1^3
# S[x^2*y] + 2*x*y*z + b1^3 = 0;
# E2*S - 3*E3 + 2*E3 + b1^3 = 0;
# E2*S - E3 + b1^3 = 0


### Classic Polynomial:

### Alternative:
### Method 2: classic
# b1*y = R - x^2
# b1^3*z = b1^2*R - (R - x^2)^2
# b1^3*z = b1^2*R - R^2 - x^4 + 2*R*x^2
# =>
# x^8 - 4*R*x^6 + (6*R^2 - 2*b1^2*R)*x^4 + 4*R^2*(b1^2 - R)*x^2 + b[1]^7*x + (b1^2*R - R^2)^2 - b[1]^6*R = 0
# (x^2 + b1*x - R) * P6;
- R*b[1]^4 + 2*R^2*b[1]^2 - R^3 + b[1]^6 + (2*R*b[1]^3 - R^2*b[1] - b[1]^5)*x + (3*R^2 - 3*R*b[1]^2 + b[1]^4)*x^2 +
	+ (2*R*b[1] - b[1]^3)*x^3 - (3*R - b[1]^2)*x^4 - b[1]*x^5 + x^6

### Debug:
### alternative / classic
coeff = c(1,0, - 4*R,0, (6*R^2 - 2*b[1]^2*R), 0, 4*R^2*(b[1]^2 - R), b[1]^7, (b[1]^2*R - R^2)^2 - b[1]^6*R)
x = roots(coeff)
y = (R - x^2)/b[1]
z = (R - y^2)/b[1]
sol = cbind(x, y, z)
sol

### Test
x^2 + b[1]*y
y^2 + b[1]*z
z^2 + b[1]*x


###################
###################

### Shifted roots:
### x[i]^2 + s*x[i] + b*x[i+1]

# x^2 + s*x + b1*y = R
# y^2 + s*y + b1*z = R
# z^2 + s*z + b1*x = R

### Solution:

### Fast Solution:
# - shift all roots "back" & use solution to simple system: x^2 + b1*y = R;
(x + s/2)^2 + b1*(y + s/2) = R + s^2/4 + b1*s/2
(y + s/2)^2 + b1*(z + s/2) = R + s^2/4 + b1*s/2
(z + s/2)^2 + b1*(x + s/2) = R + s^2/4 + b1*s/2

### Long Solution:
# - Trivial solution: x = y = z;


### Diff =>
# (x-y)*(x+y+s) = -b1*(y-z)
# (y-z)*(y+z+s) = b1*(x-z)
# (x-z)*(x+z+s) = b1*(x-y)
### Prod =>
(x+y+s)*(x+z+s)*(y+z+s) + b1^3 # = 0
# [see Workout below]

### Sum =>
S^2 - 2*E2 + (s+b1)*S - 3*R # = 0
# 2*E2 = S^2 + (s+b1)*S - 3*R;

### Sum(x[-i] * ...) =>
# Sum(x^2*y) + 2*s*E2 + b1*(x^2+y^2+z^2) + b1*E2 = 2*R*S
S*E2 - 3*E3 + 2*s*E2 + b1*(S^2 - 2*E2) + b1*E2 - 2*R*S # = 0
# 3*E3 = S*E2 + 2*s*E2 + b1*(S^2 - 2*E2) + b1*E2 - 2*R*S
# 3*E3 = S*E2 + 2*s*E2 + b1*(S^2 - E2) - 2*R*S
# 3*E3 = b1*S^2 + E2*S + 2*s*E2 - b1*E2 - 2*R*S
# 6*E3 = 2*b1*S^2 + 2*E2*S + 4*s*E2 - 2*b1*E2 - 4*R*S
# 6*E3 = 2*b1*S^2 + S*(S^2 + (s+b1)*S - 3*R) + 4*s*E2 - 2*b1*E2 - 4*R*S
# 6*E3 = S^3 + (3*s + 2*b1)*S^2 + (2*s-b1)*(s+b1)*S - 7*R*S - 6*s*R + 3*b1*R

### Sum(x[i]*...) =>
x^3 + y^3 + z^3 + s*(x^2 + y^2 + z^2) + b1*E2 - R*S # = 0
S^3 - 3*E2*S + 3*E3 + s*(S^2 - 2*E2) + b1*E2 - R*S # = 0
2*S^3 - 6*E2*S + 6*E3 + 2*s*(S^2 - 2*E2) + 2*b1*E2 - 2*R*S
-S^3 - (3*s + 2*b1)*S^2 + 6*E3 + (b1 - 2*s)*(s+b1)*S + 7*R*S + 6*s*R - 3*b1*R
-S^3 - (3*s + 2*b1)*S^2 + (S^3 + (3*s + 2*b1)*S^2 + (2*s-b1)*(s+b1)*S - 7*R*S - 6*s*R + 3*b1*R) +
	+ (b1 - 2*s)*(s+b1)*S + 7*R*S + 6*s*R - 3*b1*R
# 0 == 0 [redundant]

### [Workout] Prod =>
# (x+y+s)*(x+z+s)*(y+z+s) = -b1^3
(x^2 + x*y + x*z + y*z + s*(2*x+y+z) + s^2)*(y+z+s) + b1^3 # = 0
(x^2 + x*y + x*z + y*z)*(y+z+s) + (s*(2*x+y+z) + s^2)*(y+z+s) + b1^3 # = 0
(x^2 + x*y + x*z + y*z)*(y+z) + s*(x^2 + x*y + x*z + y*z) + (s*(2*x+y+z) + s^2)*(y+z+s) + b1^3 = 0
S*E2 - E3 + s*x^2 + s*E2 + s*(2*x+y+z)*(y+z+s) + s^2*(y+z+s) + b1^3
S*E2 - E3 + s*x^2 + s*E2 + s*(2*x+y+z)*(y+z) + s^2*(2*x+y+z) + s^2*(y+z+s) + b1^3
S*E2 - E3 + s*x^2 + s*E2 + s*(2*x+y+z)*(y+z) + 2*s^2*(x+y+z) + s^3 + b1^3
S*E2 - E3 + s*(x^2+y^2+z^2) + s*E2 + 2*s*E2 + 2*s^2*S + s^3 + b1^3
S*E2 - E3 + s*S^2 + s*E2 + 2*s^2*S + s^3 + b1^3
2*S*E2 - 2*E3 + 2*s*S^2 + 2*s*E2 + 4*s^2*S + 2*s^3 + 2*b1^3
S*(S^2 + (s+b1)*S - 3*R) - 2*E3 + 2*s*S^2 + s*(S^2 + (s+b1)*S - 3*R) + 4*s^2*S + 2*s^3 + 2*b1^3
S^3 + (4*s+b1)*S^2 - 2*E3 - 3*R*S + 5*s^2*S + s*b1*S + 2*s^3 + 2*b1^3 - 3*s*R
3*S^3 + 3*(4*s+b1)*S^2 - 6*E3 - 9*R*S + 15*s^2*S + 3*s*b1*S + 6*s^3 + 6*b1^3 - 9*s*R
2*S^3 + (9*s+b1)*S^2 + b1^2*S - 2*R*S + 13*s^2*S + 2*s*b1*S + 6*s^3 + 6*b1^3 - 3*s*R - 3*b1*R

# Note:
# Bug corrected: + 6*b1^3;

### Eq:
(2*S + 3*s + 3*b1) * (S^2 - (b1 - 3*s)*S + (- R - 2*b1*s + 2*b1^2 + 2*s^2))


######################
######################

######################
### Asymmetric Sum ###
######################

# x^2 + b1*y + b2*z = R
# y^2 + b1*z + b2*x = R
# z^2 + b1*x + b2*y = R

### Solution:

### Sum =>
S^2 - 2*E2 + (b1+b2)*S - 3*R # = 0
# E2 = (S^2 + (b1+b2)*S - 3*R)/2;

### Sum(x[i]*P[i]) =>
(x^3+y^3+z^3) + (b1 + b2)*E2 - R*S # = 0
S^3 - 3*E2*S + 3*E3 - R*S + (b1 + b2)*E2 # = 0
# =>
2*S^3 - 2*3*E2*S + 6*E3 - 2*R*S + 2*(b1 + b2)*E2 # = 0
2*S^3 - 3*(S^2 + (b1+b2)*S - 3*R)*S + 6*E3 - 2*R*S + (b1 + b2)*(S^2 + (b1+b2)*S - 3*R) # = 0
-S^3 - 2*(b1+b2)*S^2 + 6*E3 + 7*R*S + (b1+b2)*((b1+b2)*S - 3*R) # = 0
# 6*E3 = S^3 + 2*(b1+b2)*S^2 - (b1+b2)^2*S - 7*R*S + 3*(b1+b2)*R

### Eq 3:
# x^2 + b1*y + b1*z = R - (b2-b1)*z
# x^4 + b1^2*(y+z)^2 + 2*b1*x^2*(y+z) = R^2 + (b2-b1)^2*z^2 - 2*(b2-b1)*R*z
### Sum =>
# (x^4+y^4+z^4) + 2*b1^2*(x^2+y^2+z^2 + E2) + 2*b1*(E2*S - 3*E3) = 3*R^2 + (b2-b1)^2*(S^2 - 2*E2) - 2*(b2-b1)*R*S
# (x^4+y^4+z^4) + 2*b1^2*(S^2 - E2) + 2*b1*E2*S - 6*b1*E3 = 3*R^2 + (b2-b1)^2*S^2 - 2*(b2-b1)^2*E2 - 2*(b2-b1)*R*S
# (x^4+y^4+z^4) = 3*R^2 + (-b1^2 + b2^2 - 2*b1*b2)*S^2 - 2*b1*E2*S - 2*(b2^2 - 2*b1*b2)*E2 + 6*b1*E3 - 2*(b2-b1)*R*S
S^4 - 4*E2*S^2 + 4*E3*S + 2*E2^2 # =
	b1*b2*S^2 - (b1^2 + b2^2 - b1*b2)*(b1+b2)*S - 2*b2*R*S - 2*b1*R*S + 3*R^2 + 3*(b1^2 + b2^2 - b1*b2)*R;
# - 2*S^4 - 4*(b1+b2)*S^3 + 8*R*S^2 - 4*(b1^2 + b2^2)*S^2 - 14*b1*b2*S^2 + 3*(S^2 + (b1+b2)*S - 3*R)^2 + 24*(b1+b2)*R*S =
#  = - 6*(b1^2 + b2^2 - b1*b2)*(b1+b2)*S + 18*R^2 + 18*(b1^2 + b2^2 - b1*b2)*R

### Eq S:
S^4 + 2*(b1+b2)*S^3 - (b1^2 + b2^2 + 8*b1*b2 + 10*R)*S^2 + 6*(b1+b2)*R*S +
	+ 6*(b1^2 + b2^2 - b1*b2)*(b1+b2)*S + 9*R^2 - 18*(b1^2 + b2^2 - b1*b2)*R  # =  0
(S^2 + 3*(b1+b2)*S - 9*R) * (S^2 - (b1 + b2)*S + 2*(b1 + b2)^2 - 6*b2*b1 - R)

### Eq 3: Alternative
# [but redundant with Eq 3]
# Sum(y*...) =>
E21a + b1*(S^2 - 2*E2) + b2*E2 - R*S # = 0
# Sum(x^2*...) =>
S4 + b1*E21a + b2*E12a - R*(S^2 - 2*E2) # = 0
S^4 - 4*E2*S^2 + 4*E3*S + 2*E2^2 + b1*E21a + b2*E12a - R*(S^2 - 2*E2) # = 0
# =>
S^4 - 4*E2*S^2 + 4*E3*S + 2*E2^2 + (b1 - b2)*E21a + b2*(E2*S - 3*E3) - R*(S^2 - 2*E2) # = 0
S^4 - 4*E2*S^2 + 4*E3*S + 2*E2^2 - R*S^2 - (b1 - b2)*(b1*S^2 - 2*b1*E2 + b2*E2 - R*S) +
	+ b2*E2*S - 3*b2*E3 + 2*R*E2 # = 0
# Diff: Eq 3 (alt) - Eq 3 =>
R*S^2 + (b1 - 2*b2)*b1*S^2 - (b1 - b2)*(2*b1 - b2)*E2 - b2*E2*S + 3*b2*E3 - 2*R*E2 +
	+ (b1^2 + b2^2 - b1*b2)*(b1+b2)*S + (b1 + 3*b2)*R*S - 3*R^2 - 3*(b1^2 + b2^2 - b1*b2)*R # = 0


### Diff =>
# [NOT used]
# x^2 - y^2 = b2*(x - z) - b1*(y - z)
# x^2 - z^2 = b2*(y - z) - b1*(y - x)
# y^2 - z^2 = b2*(y - x) - b1*(z - x)


### Derivation:

### Classic:
# b2*z = -x^2 - b1*y + R
# =>
b2*y^2 - b1^2*y - b1*x^2 + b2^2*x + (b1 - b2)*R # = 0
# &
(x^2 + b1*y - R)^2 + b1*b2^2*x + b2^3*y - b2^2*R # = 0
x^4 + b1^2*y^2 + R^2 + 2*b1*x^2*y - 2*R*x^2 - 2*b1*R*y + b1*b2^2*x + b2^3*y - b2^2*R # = 0
4*b2^2*x^4 - 8*b2^2*R*x^2 + b1^2*(4*b2^2*y^2) + (4*b1*b2*x^2 + 2*b2^4 - 4*b1*b2*R)*2*b2*y +
	+ 4*b1*b2^4*x - 4*b2^4*R + 4*b2^2*R^2 # = 0
# Sol Eq 2 =>
# y = (b1^2 + sqrt(b1^4 + 4*b1*b2*x^2 - 4*b2^3*x - 4*b2*(b1 - b2)*R)) / (2*b2)
# y = (b1^2 - sqrt(b1^4 + 4*b1*b2*x^2 - 4*b2^3*x - 4*b2*(b1 - b2)*R)) / (2*b2)
# =>
4*b2^2*x^4 - 8*b2^2*R*x^2 +
	+ 4*b1^3*b2*x^2 - 4*b1^2*b2^3*x - 4*b1^3*b2*R + 4*b1^2*b2^2*R +
	+ 4*b1^3*b2*x^2 + 2*b1^2*b2^4 - 4*b1^3*b2*R + 4*b1*b2^4*x - 4*b2^4*R + 4*b2^2*R^2 + 2*b1^6 + # b1^4 +
	(2*b1^4 + 2*b2^4 + 4*b1*b2*x^2 - 4*b1*b2*R)*sqrt(b1^4 + 4*b1*b2*x^2 - 4*b2^3*x - 4*b2*(b1 - b2)*R)
### P[8]
(16*R*b1*b2^9 - 16*R*b1^2*b2^8 - 16*R*b1^4*b2^6 + 16*R*b1^5*b2^5 - 16*R*b1^6*b2^4 - 16*R*b2^10 + 64*R^2*b1*b2^7 - 80*R^2*b1^2*b2^6 + 64*R^2*b1^3*b2^5 + 16*R^2*b1^4*b2^4 + 16*R^2*b2^8 - 32*R^3*b1^2*b2^4 - 32*R^3*b2^6 + 16*R^4*b2^4) +
(- 96*R*b1*b2^8 + 32*R*b1^2*b2^7 + 32*R*b1^3*b2^6 - 96*R*b1^4*b2^5 + 32*R^2*b1*b2^6 + 32*R^2*b1^2*b2^5 + 16*b1^3*b2^8 + 16*b1^4*b2^7 + 16*b1^7*b2^4 + 16*b2^11)*x^1 +
(- 64*R*b1*b2^7 + 96*R*b1^2*b2^6 - 64*R*b1^3*b2^5 + 64*R^2*b1^2*b2^4 + 64*R^2*b2^6 - 64*R^3*b2^4 - 16*b1*b2^9 + 16*b1^2*b2^8 - 32*b1^3*b2^7 + 16*b1^4*b2^6 - 16*b1^5*b2^5)*x^2 +
(- 64*R*b1*b2^6 - 64*R*b1^2*b2^5 + 64*b1*b2^8 + 64*b1^4*b2^5)*x^3 +
(- 32*R*b1^2*b2^4 - 32*R*b2^6 + 96*R^2*b2^4 - 48*b1^2*b2^6)*x^4 +
(32*b1*b2^6 + 32*b1^2*b2^5)*x^5 +
(- 64*R*b2^4)*x^6 +
(16*b2^4)*x^8


### P[8] is decomposable:
# P[8] = P[2]*P[6]
# P[2] = x^2 + (b1+b2)*x - R;
### P[6]
x^6 - (b1 + b2)*x^5 + ((b1 + b2)^2 - 3*R)*x^4 +
	- (b1 + b2)*((b1 + b2)^2 - 2*b1*b2 - 2*R)*x^3 +
	+ ((b1 + b2)^4 - 2*b1*b2*(b1 + b2)^2 - 3*b1^2*b2^2 + 4*b1*b2*R - 3*(b1 + b2)^2*R + 3*R^2)*x^2 +
	- (b1 + b2)*((b1 + b2)^4 - 6*b1*b2*(b1 + b2)^2 + 9*b1^2*b2^2 +
		+ R^2 - 2*(b1 + b2)^2*R + 6*b1*b2*R)*x +
	+ ((b1 + b2)^6 - 7*b1*b2*(b1 + b2)^4 + 14*b1^2*b2^2*(b1 + b2)^2 - 6*b1^3*b2^3 +
		- R^3 + 2*(b1 + b2)^2*R^2 - 4*b1*b2*R^2 - (b1 + b2)^4*R + 11*b1^2*b2^2*R);

### Classic Solver:

b1 = b[1]; b2 = b[2]; bs = b1 + b2;
coeff = c(
	1, - bs, (bs^2 - 3*R),
	- bs*(bs^2 - 2*b1*b2 - 2*R),
	+ (bs^4 - 2*b1*b2*bs^2 - 3*b1^2*b2^2 + 4*b1*b2*R - 3*bs^2*R + 3*R^2),
	- bs*(bs^4 - 6*b1*b2*bs^2 + 9*b1^2*b2^2 +
		+ R^2 - 2*bs^2*R + 6*b1*b2*R),
	+ (bs^6 - 7*b1*b2*bs^4 + 14*b1^2*b2^2*bs^2 - 6*b1^3*b2^3 +
		- R^3 + 2*bs^2*R^2 - 4*b1*b2*R^2 - bs^4*R + 11*b1^2*b2^2*R)
)
coeff

x = roots(coeff)
yz.bsum = R - x^2
y = as.vector(sapply(1:length(x), function(id) roots(c(1, -b[1]^2/b[2], -R + b[2]*x[id] + b[1]/b[2]*yz.bsum[id]))))
yz.bsum = rep(yz.bsum, each=2); x = rep(x, each=2);
z = (yz.bsum - b[1]*y) / b[2]


### Test
x^2 + b[1]*y + b[2]*z
y^2 + b[1]*z + b[2]*x
z^2 + b[1]*x + b[2]*y

# sapply(x, function(x) sum(x^(8:0) * coeff))
# poly.calc(x[c(7,8)])
# poly.calc(x[-c(7,8)])


###################
###################

###############
### Order 3 ###
###############

### x[i]^3 + b*x[i+1]

# x^3 + b*y = R
# y^3 + b*z = R
# z^3 + b*x = R

### Solution:

# Trivial solution: x = y = z;

### Formulas used:
# x^3 + y^3 + z^3 = S^3 - 3*E2*S + 3*E3;
# x^4 + y^4 + z^4 = S^4 - 4*E2 * S^2 + 4*E3 * S + 2*E2^2;
# x^3*y^3 + x^3*z^3 + y^3*z^3 = E2^3 + 3*E3^2 - 3*E3*E2*S
# x^4*y^2 + x^4*z^2+ x^2*y^4 + y^4*z^2 + y^2*z^4 + x^2*z^4 = E2^2*S^2 - 2*E3*S^3 + 4*E3*E2*S - 3*E3^2 - 2*E2^3

### Sum =>
x^3 + y^3 + z^3 + b*(x+y+z) - 3*R # = 0
S^3 - 3*E2*S + 3*E3 + b*S - 3*R # = 0;
# 3*E2*S = S^3 + 3*E3 + b*S - 3*R
# =>
# 6*E3 = 6*E2*S - 2*S^3 - 2*b*S + 6*R

### Sum(x[i]*...) =>
x^4 + y^4 + z^4 + b*E2 - R*S # = 0
S^4 - 4*E2*S^2 + 4*E3 * S + 2*E2^2 + b*E2 - R*S # = 0;

### Solve E2 & E3:
S^4 - 4*E2*S^2 + 4*E3*S + 2*E2^2 + b*E2 - R*S # = 0
3*S^4 - 12*E2*S^2 + 2*6*E3*S + 6*E2^2 + 3*b*E2 - 3*R*S # = 0
3*S^4 - 12*E2*S^2 + 2*(6*E2*S - 2*S^3 - 2*b*S + 6*R)*S + 6*E2^2 + 3*b*E2 - 3*R*S # = 0
# E2 =>
6*E2^2 + 3*b*E2 - (S^4 + 4*b*S^2 - 9*R*S) # = 0

# alternative: E2 =>
3*S^4 - 4*3*E2*S^2 + 12*E3*S + 2*3*E2^2 + 3*b*E2 - 3*R*S # = 0
3*S^4 - 4*(S^3 + 3*E3 + b*S - 3*R)*S + 12*E3*S + 2*3*E2^2 + 3*b*E2 - 3*R*S # = 0
S^4 + 4*b*S^2 - 9*R*S - 2*3*E2^2 - 3*b*E2 # = 0
S^5 + 3*b*S^3 - 9*R*S^2 - b^2*S - 2*(S^3 + 3*E3 + b*S - 3*R)*E2 - 3*b*E3 + 3*b*R # = 0
S^5 + 4*b*S^3 - 9*R*S^2 - 2*(S^3 + 3*E3 + 5/2*b*S - 3*R)*E2 # = 0


### Sum(x[i+1]^3*...) =>
(x^3*y^3 + x^3*z^3 + y^3*z^3) + b*(x^4 + y^4 + z^4) - R*(x^3 + y^3 + z^3) # = 0
E2^3 + 3*E3^2 - 3*E3*E2*S + b*(S^4 - 4*E2 * S^2 + 4*E3 * S + 2*E2^2) +
	- R*(S^3 - 3*E2*S + 3*E3) # = 0
b*S^4 - R*S^3 - 4*b*E2*S^2 + 3*R*E2*S + 4*b*E3*S - 3*E3*E2*S - 3*R*E3 + E2^3 + 2*b*E2^2 + 3*E3^2

### [old] Diff =>
# x^3 - y^3 = b*(z-y)
# y^3 - z^3 = b*(x-z)
# z^3 - x^3 = b*(y-x)
### Prod =>
(x^2 + y^2 + x*y)*(x^2 + z^2 + x*z)*(y^2 + z^2 + y*z) + b^3 # = 0
# =>
E2^3 - E2^2*S^2 + E3*S^3 - b^3 # = 0

### Solve: E2, E3, S
6*E2^2 + 3*b*E2 - (S^4 + 4*b*S^2 - 9*R*S) # = 0
3*E3 - (3*E2*S - S^3 - b*S + 3*R) # = 0
E2^3 + 2*b*E2^2 + 3*E3^2 + b*S^4 - R*S^3 - 4*b*E2*S^2 + 3*R*E2*S + 4*b*E3*S - 3*E3*E2*S - 3*R*E3 # = 0
E2^3 - E2^2*S^2 + E3*S^3 - b^3 # = 0

pE30 = data.frame(
	E2 = c(1, 0,0,0), S = c(1, 3,1,0),
	b  = c(0, 0,1,0), R = c(0, 0,0,1), coeff = c(3,-1,-1,3)
)
pE3Div = data.frame(coeff=3)
pE21 = data.frame(
	E2 = c(2, 1, 0, 0, 0),
	S  = c(0, 0, 4, 2, 1),
	b  = c(0, 1, 0, 1, 0),
	R  = c(0, 0, 0, 0, 1),
	coeff = c(6, 3,-1,-4, 9)
)
pE23 = data.frame(
	E3 = c(0, 0, 1, 0),
	E2 = c(3, 2, 0, 0),
	S  = c(0, 2, 3, 0),
	b  = c(0, 0, 0, 3),
	R  = c(0, 0, 0, 0),
	coeff = c(1,-1,1,-1)
)
pE23r = replace.fr.pm(pE23, pE30, pE3Div, x="E3")
pE2 = solve.pm(pE21, pE23r, x="E2")
pE2x0 = pE2$x0; pE2x0$coeff = pE2x0$coeff / -9;
print.p(pE2x0, "S")
pE2Div = pE2$div; pE2Div$coeff = pE2Div$coeff / -9;
print.p(pE2Div, "S")

E2x0 = 6*S^6 + 13*b*S^4 - 30*R*S^3 + 4*b^2*S^2 - 9*b*R*S + 12*b^3;
E2div = 14*S^4 + 14*b*S^2 - 18*R*S + 3*b^2;

### E2, E3 =>
12*b*S^4 - 12*R*S^3 - 48*b*E2*S^2 + 36*R*E2*S + 8*b*(6*E2*S - 2*S^3 - 2*b*S + 6*R)*S +
	- 6*(6*E2*S - 2*S^3 - 2*b*S + 6*R)*E2*S - 6*R*(6*E2*S - 2*S^3 - 2*b*S + 6*R) +
	+ 12*E2^3 + 24*b*E2^2 + (6*E2*S - 2*S^3 - 2*b*S + 6*R)^2
4*S^6 - 12*E2*S^4 + 4*b*S^4 - 24*R*S^3 - 12*b^2*S^2 - 12*b*E2*S^2 + 36*b*R*S +
	+ 36*R*E2*S + 12*E2^3 + 24*b*E2^2  # (6*E2*S - 2*S^3 - 2*b*S + 6*R)^2
4*S^6 + 7*b*S^4 - 24*R*S^3 + 9*b*R*S - 10*E2*S^4 - 4*b*E2*S^2 + 18*R*E2*S - 9*b^2*E2
# 4*E2 = - b + 1/3 * sqrt(Det); 4*E2 = - b - 1/3 * sqrt(Det);
Det = (9*b^2 + 24*S^4 + 96*b*S^2 - 216*R*S)
# =>
4*S^6 + 7*b*S^4 - 24*R*S^3 + 9*b*R*S - (10*S^4 + 4*b*S^2 - 18*R*S + 9*b^2)*E2
16*S^6 + 28*b*S^4 - 96*R*S^3 + 36*b*R*S - (10*S^4 + 4*b*S^2 - 18*R*S + 9*b^2)*(- b + 1/3 * sqrt(Det))
48*S^6 + 114*b*S^4 + 12*b^2*S^2 - 288*R*S^3 + 54*b*R*S + 27*b^3 - (10*S^4 + 4*b*S^2 - 18*R*S + 9*b^2)*sqrt(Det)


#######
### Eq:
# "P12" = S * P[3] * P[8]
S^12 + 6*b*S^10 - 27*R*S^9 - 9*b^2*S^8 + 54*R*b*S^7 + (27*R^2 + 166*b^3)*S^6 +
	+ (- 756*R*b^2)*S^5 + (972*R^2*b + 45*b^4)*S^4 + (- 351*R*b^3 - 729*R^3)*S^3 +
	+ (729*R^2*b^2 + 81*b^5)*S^2 - 243*R*b^4*S + 0
S * (S^3 + 9*b*x - 27*R) * P[8]
### P[8]
S^8 - 3*b*S^6 + 18*b^2*S^4 - 27*R*b*S^3 + (27*R^2 + 4*b^3)*S^2 - 27*R*b^2*S + 9*b^4


### Derivation
# [old version]
(x^3*y^3 + x^3*z^3 + y^3*z^3) + # = E2^3 - 6*E3^2 - 3*E3*S*(S^2 - 2*E2) + 3*E3*(S^3 - 3*E2*S + 3*E3)
	+ x^4*y^2 + x^4*z^2+ x^2*y^4 + y^4*z^2 + y^2*z^4 + x^2*z^4 + # = E2^2 *(S^2 - 2*E2) - 2*E3*(E2*S - 2*E3) - 2*E3*(S^3 - 3*E2*S + 3*E3) - E3^2
	+ 2*x*y*z*(x^2*y + x^2*z + x*y^2 + y^2*z + x*z^2 + y*z^2) + # = 2*E3*(E2*S - 3*E3)
	+ x*y*z*(x^3 + y^3 + z^3) +  3*(x*y*z)^2 + b^3
#
E2^3 + 3*E3^2 - 3*E3*E2*S + E2^2*S^2 - 2*E3*S^3 + 4*E3*E2*S - 3*E3^2 - 2*E2^3 + 
	+ 2*E3*(E2*S - 3*E3) + E3*(S^3 - 3*E2*S + 3*E3) + 3*E3^2 + b^3
#
E2^3 - E2^2*S^2 + E3*S^3 - b[1]^3


### Debug:
R = -1; b = 2;
x = 1.017099842 + 1.195427591i;
y = 1.154134537 - 1.000829399i;
z = 0.465405799 + 1.498451837i;
S = x+y+z; E2 = x*y+x*z+y*z; E3 = x*y*z;


### Classic Polynomial
# - factorization: P3 * P24;
(- R[1]^2*b[1]^9 + 3*R[1]^4*b[1]^6 - 3*R[1]^6*b[1]^3 + R[1]^8 + b[1]^12) +
(- R[1]*b[1]^10 + 3*R[1]^3*b[1]^7 - 3*R[1]^5*b[1]^4 + R[1]^7*b[1])*x +
(3*R[1]^2*b[1]^8 - 3*R[1]^4*b[1]^5 + R[1]^6*b[1]^2 - b[1]^11)*x^2 +
(2*R[1]*b[1]^9 - 9*R[1]^3*b[1]^6 + 16*R[1]^5*b[1]^3 - 8*R[1]^7)*x^3 +
(- 6*R[1]^2*b[1]^7 + 13*R[1]^4*b[1]^4 - 7*R[1]^6*b[1] + b[1]^10)*x^4 +
(- 3*R[1]*b[1]^8 + 10*R[1]^3*b[1]^5 - 6*R[1]^5*b[1]^2)*x^5 +
(10*R[1]^2*b[1]^6 - 35*R[1]^4*b[1]^3 + 28*R[1]^6 - b[1]^9)*x^6 +
(4*R[1]*b[1]^7 - 22*R[1]^3*b[1]^4 + 21*R[1]^5*b[1])*x^7 +
(- 12*R[1]^2*b[1]^5 + 15*R[1]^4*b[1]^2 + b[1]^8)*x^8 +
(- 5*R[1]*b[1]^6 + 40*R[1]^3*b[1]^3 - 56*R[1]^5)*x^9 +
(18*R[1]^2*b[1]^4 - 35*R[1]^4*b[1] - b[1]^7)*x^10 +
(6*R[1]*b[1]^5 - 20*R[1]^3*b[1]^2)*x^11 +
(- 25*R[1]^2*b[1]^3 + 70*R[1]^4 + b[1]^6)*x^12 +
(- 7*R[1]*b[1]^4 + 35*R[1]^3*b[1])*x^13 +
+ (15*R[1]^2*b[1]^2 - b[1]^5)*x^14 +
+ (8*R[1]*b[1]^3 - 56*R[1]^3)*x^15 +
+ (- 21*R[1]^2*b[1] + b[1]^4)*x^16 +
+ (- 6*R[1]*b[1]^2)*x^17 +
+ (28*R[1]^2 - b[1]^3)*x^18 +
+ 7*R[1]*b[1]*x^19 +
+ b[1]^2*x^20 +
- 8*R[1]*x^21 +
- b[1]*x^22 + x^24

### Derivation:
y = (-x^3 + R) / b[1]
z = ((x^3 - R)^3 + R*b[1]^3) / b[1]^4
# b^12*z^3 + b^13*x - R*b^12 = 0
((x^3 - R)^3 + R*b[1]^3)^3 + b[1]^13*x - R*b[1]^12


x^27 - 9*R*x^24 + 36*R^2*x^21 + 3*R*(b[1]^3 - 28*R^2)*x^18 - 18*R^2*(b[1]^3 - 7*R^2)*x^15 +
	+ 9*R^3*(5*b[1]^3 - 14*R^2)*x^12 +
	+ 3*(R^2*b[1]^6 - 20*R^4*b[1]^3 + 28*R^6)*x^9 - 9*R^3*(b[1]^6 - 5*R^2*b[1]^3 + 4*R^4)*x^6 +
	+ 9*R^4*(b[1]^6 - 2*R^2*b[1]^3 + R^4)*x^3 + b[1]^13*x +
	- (R*b[1]^12 - R^3*b[1]^9 + 3*R^5*b[1]^6 - 3*R^7*b[1]^3 + R^9)


coeff = c(1,0,0, - 9*R, 0,0, 36*R^2, 0,0, 3*R*(b[1]^3 - 28*R^2), 0,0, - 18*R^2*(b[1]^3 - 7*R^2), 0,0,
	9*R^3*(5*b[1]^3 - 14*R^2),
	0,0, 3*(R^2*b[1]^6 - 20*R^4*b[1]^3 + 28*R^6), 0,0, - 9*R^3*(b[1]^6 - 5*R^2*b[1]^3 + 4*R^4), 0,0,
	9*R^4*(b[1]^6 - 2*R^2*b[1]^3 + R^4), 0, b[1]^13,
	- (R*b[1]^12 - R^3*b[1]^9 + 3*R^5*b[1]^6 - 3*R^7*b[1]^3 + R^9))
x = roots(coeff)


#####################
#####################

###############
### Order 4 ###
###############

### x[i]^4 + b*x[i+1]

# x^4 + b*y = R
# y^4 + b*z = R
# z^4 + b*x = R

### Solution:

### Sum =>
(x^4 + y^4 + z^4) + b*S - 3*R # = 0
S^4 - 4*E2*S^2 + 4*E3*S + 2*E2^2 + b*S - 3*R # = 0

### Sum(x*...) =>
(x^5 + y^5 + z^5) + b*E2 - R*S # = 0
S^5 - 5*E2*S^3 + 5*E3*S^2 + 5*E2^2*S - 5*E2*E3 + b*E2 - R*S # = 0

### Sum(y^4*...) =>
((x*y)^4 + (y*z)^4 + (x*z)^4) + b*(x^5 + y^5 + z^5) - R*(x^4 + y^4 + z^4) # = 0
((x*y)^4 + (y*z)^4 + (x*z)^4) + b*(x^5 + y^5 + z^5) - R*(x^4 + y^4 + z^4) # = 0
(4*E2*E3^2 + E2^4 - 4*E2^2*E3*S + 2*E3^2*S^2) +
	+ b*(S^5 - 5*E2*S^3 + 5*E3*S^2 + 5*E2^2*S - 5*E2*E3) +
	- R*(S^4 - 4*E2*S^2 + 4*E3*S + 2*E2^2) # = 0
4*E2*E3^2 + 2*E3^2*S^2 - 4*E2^2*E3*S - 5*b*E2*E3 + 5*b*E3*S^2 - 4*R*E3*S +
	+ E2^4 + 5*b*E2^2*S - 2*R*E2^2 - 5*b*E2*S^3 + 4*R*E2*S^2 +
	+ b*S^5 - R*S^4 # = 0


### Sum(z*...) =>
# [exploring alternative formulas]
(x^4*z + y^4*x + z^4*y) + b*E2 - R*S # = 0
(x^4*z + y^4*x + z^4*y)*(x^4*y + y^4*z + z^4*x) + (b*E2 - R*S)^2 +
	+ (b*E2 - R*S)*(x^4*z + y^4*x + z^4*y + x^4*y + y^4*z + z^4*x) # = 0
(x^4*z + y^4*x + z^4*y)*(x^4*y + y^4*z + z^4*x) + (b*E2 - R*S)^2 +
	+ (b*E2 - R*S)*((x^4 + y^4 + z^4)*S - (x^5 + y^5 + z^5)) # = 0
(x^4*z + y^4*x + z^4*y)*(x^4*y + y^4*z + z^4*x) + (b*E2 - R*S)^2 +
	+ (b*E2 - R*S)*((3*R - b*S)*S - (R*S - b*E2)) # = 0
E3*(x^7 + y^7 + z^7) + E3^2*(x^2*y^2 + y^2*z^2 + z^2*x^2) + (x^5*y^5 + y^5*z^5 + z^5*x^5) +
	+ (b*E2 - R*S)^2 + (b*E2 - R*S)*((3*R - b*S)*S - (R*S - b*E2)) # = 0


### Test
x^4 + b*y # - R
y^4 + b*z # - R
z^4 + b*x # - R

### Debug:
R = 2; b = -1;
x = 0.0166744490 +  1.3427742695i;
y = 1.2479553174 - 0.1614557583i;
z = 0.1825626110 - 1.2341836974i;
S = x+y+z; E2 = x*y+x*z+y*z; E3 = x*y*z;


#############################

#############################
### Univariate Side-Chain ###
#############################

### x[i]^3 + b2*x[j]^2 + b1*x[j]

# x^3 + b2*y^2 + b1*y = R
# y^3 + b2*z^2 + b1*z = R
# z^3 + b2*x^2 + b1*x = R


### Solution:

### Case: (x, y, z) distinct

### Sum =>
x^3 + y^3 + z^3) + b2*(x^2 + y^2 + z^2) + b1*S - 3*R # = 0
S^3 - 3*E2*S + 3*E3 + b2*(S^2 - 2*E2) + b1*S - 3*R # = 0
S^3 + b2*S^2 + b1*S - 3*E2*S - 2*b2*E2 + 3*E3 - 3*R # = 0
# 3*E3 = -(S^3 + b2*S^2 + b1*S - 3*E2*S - 2*b2*E2 - 3*R)


### Sum( (b[1]*x[i] + b[2]*x[i]^2) * ...) =>
b[2]*(x^5 + y^5 + z^5) + b[1]*(x^4 + y^4 + z^4) +
	+ b[1]*b[2]*(x^2*y + x*y^2 + x^2*z + x*z^2 + y^2*z + y*z^2) + b[1]^2*E2 + b[2]^2*(E2^2 - 2*E3*S) +
	- b[2]*R*(x^2+y^2+z^2) - b[1]*R*S # = 0
b[2]*(S^5 - 5*E2*S^3 + 5*E3*S^2 + 5*E2^2*S - 5*E2*E3) + b[1]*(S^4 - 4*E2*S^2 + 4*E3*S + 2*E2^2) +
	+ b[1]*b[2]*(E2*S - 3*E3) + b[1]^2*E2 + b[2]^2*(E2^2 - 2*E3*S) +
	- b[2]*R*(S^2 - 2*E2) - b[1]*R*S # = 0
b2*S^5 + b1*S^4 - 5*b2*E2*S^3 + 5*b2*E3*S^2 - 5*b2*E2*E3 + 4*b1*E3*S - 2*b2^2*E3*S +
	- 4*b1*E2*S^2 + 5*b2*E2^2*S - 2*b1*b2*E2*S +
	+ 2*b1*E2^2 + b2^2*E2^2 + b1^2*E2 - 2*b1*b2^2*E2 +
	+ b1*b2*S^3 + b1*b2^2*S^2 + b1^2*b2*S +
	- b2*R*S^2 + 2*b2*R*E2 - b1*R*S - 3*b1*b2*R # = 0


### Sum(y^3*...) =>
(x^3*y^3 + x^3*z^3 + y^3*z^3) + b2*(x^5 + y^5 + z^5) + b1*(x^4 + y^4 + z^4) +
	- R*(x^3 + y^3 + z^3) # = 0
(E2^3 - 3*E3*(E2*S - E3)) +
	+ b2*(S^5 - 5*E2*S^3 + 5*E3*S^2 + 5*E2^2*S - 5*E2*E3) +
	+ b1*(S^4 - 4*E2*S^2 + 4*E3*S + 2*E2^2) +
	- R*(S^3 - 3*E2*S + 3*E3) # = 0
E2^3 - 3*E3*E2*S + 3*E3^2 +
	+ b2*S^5 - 5*b2*E2*S^3 + 5*b2*E3*S^2 + 5*b2*E2^2*S - 5*b2*E2*E3 +
	+ b1*S^4 - 4*b1*E2*S^2 + 4*b1*E3*S + 2*b1*E2^2 +
	- R*S^3 + 3*R*E2*S - 3*R*E3 # = 0


### Auxiliary Eqs:
E2Subst = 1701*R*S*b1*b2^4 - 243*R*S*b1^3 - 756*R*S*b2^6 + 918*R*S^2*b1*b2^3 - 243*R*S^2*b1^2*b2 + 288*R*S^2*b2^5 - 1782*R*S^3*b1*b2^2 + 648*R*S^3*b1^2 + 450*R*S^3*b2^4 - 486*R*S^4*b1*b2 - 945*R*S^4*b2^3 - 702*R*S^5*b2^2 - 1134*R*b1*b2^5 + 1620*R*b1^2*b2^3 - 729*R*b1^3*b2 + 729*R^2*S*b1*b2 - 486*R^2*S*b2^3 + 972*R^2*S^2*b2^2 - 729*R^2*b1*b2^2 + 378*S*b1^2*b2^5 - 540*S*b1^3*b2^3 + 243*S*b1^4*b2 + 630*S^2*b1*b2^6 - 1233*S^2*b1^2*b2^4 + 504*S^2*b1^3*b2^2 - 537*S^3*b1*b2^5 - 180*S^3*b1^2*b2^3 + 90*S^3*b1^3*b2 + 252*S^3*b2^7 - 516*S^4*b1*b2^4 + 540*S^4*b1^2*b2^2 - 189*S^4*b1^3 + 30*S^4*b2^6 + 576*S^5*b1*b2^3 - 27*S^5*b1^2*b2 - 144*S^5*b2^5 + 513*S^6*b1*b2^2 - 108*S^6*b1^2 + 186*S^6*b2^4 + 45*S^7*b1*b2 + 297*S^7*b2^3 + 90*S^8*b2^2;

E2Div = 1539*R*S*b1*b2^2 - 486*R*S*b1^2 - 459*R*S*b2^4 + 648*R*S^2*b1*b2 + 702*R*S^2*b2^3 + 810*R*S^3*b2^2 - 567*R*b1*b2^3 + 189*R*b2^5 - 729*R^2*b2^2 + 819*S*b1*b2^5 - 45*S*b1^2*b2^3 - 108*S*b1^3*b2 - 504*S*b2^7 + 954*S^2*b1*b2^4 - 621*S^2*b1^2*b2^2 + 108*S^2*b1^3 - 123*S^2*b2^6 - 810*S^3*b1*b2^3 + 162*S^3*b1^2*b2 + 312*S^3*b2^5 - 945*S^4*b1*b2^2 + 270*S^4*b1^2 - 369*S^4*b2^4 - 108*S^5*b1*b2 - 684*S^5*b2^3 - 225*S^6*b2^2 - 756*b1*b2^6 + 1458*b1^2*b2^4 - 1026*b1^3*b2^2 + 243*b1^4;
# E2 = - E2Subst / E2Div;


### Classic Polynomial
# - see file: Poly.System.S3P3.Mega.ClassicPoly.R;
(3*b1*b2*y^3 + 2*b2^4*x^2 + 2*b1*b2^3*x - 2*b2^3*R - b1^3 - 3*b1*b2*R)^2 +
	+ (b2*y^3 - b1^2 - b2*R)^2*(4*b2*y^3 - b1^2 - 4*b2*R)
(3*b1^3*y - 3*b1*b2*(x^3 - R)*y + 3*b1^2*x^3 + 2*b2^5*x^2 + 2*b1*b2^4*x +
		- 3*b1^2*R - 2*b2^4*R - b1^3*b2 - 3*b1*b2^2*R)^2 +
	+ (b1^2*y - b2*(x^3-R)*y + b1*x^3 - b1^2*b2 - b1*R - b2^2*R)^2*(4*b2*y^3 - b1^2 - 4*b2*R)


### Debug
R = 2; b = c(-1, 3); b2=b[1]; b1 = b[2];
x = -0.84266687675 - 0.67429501628i;
y =  0.45452251454 + 0.54034691130i;
z =  1.75594150810 + 0.34602494638i;
S = x+y+z; E2 = x*y+x*z+y*z; E3 = x*y*z;


########################

########################
### Mixed Side-Chain ###
########################

### x[i]^3 + b2*x[j]^2 + b1*x[k]

# x^3 + b2*y^2 + b1*z = R
# y^3 + b2*z^2 + b1*x = R
# z^3 + b2*x^2 + b1*y = R


### Solution:

### Sum =>
(x^3 + y^3 + z^3) + b2*(x^2 + y^2 + z^2) + b1*S - 3*R # = 0
S^3 - 3*E2*S + 3*E3 + b2*(S^2 - 2*E2) + b1*S - 3*R # = 0
S^3 + b2*S^2 + b1*S - 3*E2*S - 2*b2*E2 + 3*E3 - 3*R # = 0
# 3*E3 = -(S^3 + b2*S^2 + b1*S - 3*E2*S - 2*b2*E2 - 3*R)

### Eq2:
# x^3 + b1*z = R - b2*y^2
# x^3 + b1*y + b1*z = R - b2*y^2 + b1*y # Sq =>
# (x^3 + b1*y + b1*z)^2 = (b2*y^2 - b1*y - R)^2
x^6 + b1^2*y^2 + b1^2*z^2 + 2*b1*x^3*y + 2*b1*x^3*z + 2*b1^2*y*z # =
	b2^2*y^4 + b1^2*y^2 + R^2 - 2*b1*b2*y^3 - 2*b2*R*y^2 + 2*b1*R*y
### Sum =>
(x^6+y^6+z^6) + 2*b1^2*(x^2+y^2+z^2) + 2*b1*(x^3*y+x^3*z+y^3*x+y^3*z+z^3*x+z^3*y) + 2*b1^2*E2 # =
	b2^2*(x^4+y^4+z^4) - 2*b1*b2*(x^3+y^3+z^3) + (b1^2 - 2*b2*R)*(x^2+y^2+z^2) + 2*b1*R*S + 3*R^2
### sum(x^3*y) = (x^2+y^2+z^2)*E2 - E3*S
- 3*E3^2 + 12*E2*E3*S - 6*E3*S^3 + 4*b2^2*E3*S + 2*b1*E3*S - 6*b1*b2*E3 +
	+ 2*E2^3 - 9*E2^2*S^2 + 2*b2^2*E2^2 + 4*b1*E2^2 +
	+ 6*E2*S^4 - 4*b2^2*E2*S^2 - 2*b1*E2*S^2 + 6*b1*b2*E2*S + 4*b2*R*E2 +
	- S^6 + b2^2*S^4 - 2*b1*b2*S^3 - 2*b2*R*S^2 - b1^2*S^2  + 2*b1*R*S + 3*R^2 # = 0

### Eq3:
# x^3 + b2*y^2 = R - b1*z
# x^3 + b2*y^2 + b2*z^2 = b2*z^2 - b1*z + R
# (x^3 + b2*y^2 + b2*z^2)^2 = (b2*z^2 - b1*z + R)^2
x^6 + 2*b2*x^3*y^2 + 2*b2*x^3*z^2 + b2^2*y^4 + b2^2*z^4 + 2*b2^2*y^2*z^2 # =
	b2^2*z^4 - 2*b1*b2*z^3 + b1^2*z^2 + 2*b2*R*z^2 - 2*b1*R*z + R^2
### Sum =>
(x^6+y^6+z^6) + 2*b2^2*(x^4+y^4+z^4) + 2*b2^2*(E2^2 - 2*E3*S) +
	+ 2*b2*(x^3*y^2+x^3*z^2+y^3*x^2+y^3*z^2+z^3*x^2+z^3*y^2) # =
	b2^2*(x^4+y^4+z^4) - 2*b1*b2*(x^3+y^3+z^3) + (b1^2 + 2*b2*R)*(x^2+y^2+z^2) - 2*b1*R*S + 3*R^2
### sum(x^3*y^2) = (E2^2 - 2*E3*S)*S - E3*E2
3*E3^2 - 12*E2*E3*S - 2*b2*E2*E3 + 6*E3*S^3 - 4*b2*E3*S^2 + 6*b1*b2*E3 +
	- 2*E2^3 + 9*E2^2*S^2 + 2*b2*E2^2*S + 4*b2^2*E2^2 +
	- 6*E2*S^4 - 4*b2^2*E2*S^2 - 6*b1*b2*E2*S + 2*b1^2*E2 + 4*b2*R*E2 +
	+ S^6 + b2^2*S^4 + 2*b1*b2*S^3 - b1^2*S^2 - 2*b2*R*S^2 + 2*b1*R*S - 3*R^2 # = 0
# Diff: Eq 2 - Eq 3 =>
b2*E2*E3 + 2*b2*E3*S^2 - 2*b2^2*E3*S - b1*E3*S +
	- b2*E2^2*S - 3*b2^2*E2^2 - 2*b1*E2^2 +
	+ 4*b2^2*E2*S^2 + b1*E2*S^2 - b1^2*E2 - 4*b2*R*E2 +
	- b2^2*S^4 + b1^2*S^2 + 2*b2*R*S^2 - 2*b1*R*S # = 0

# =>
# 3*E3 = -(S^3 + b2*S^2 + b1*S - 3*E2*S - 2*b2*E2 - 3*R)
pE3x3 = toPoly.pm("-(S^3 + b2*S^2 + b1*S - 3*E2*S - 2*b2*E2 - 3*R)");
p2 = toPoly.pm("b2*E2*E3 + 2*b2*E3*S^2 - 2*b2^2*E3*S - b1*E3*S +
	- b2*E2^2*S - 3*b2^2*E2^2 - 2*b1*E2^2 +
	+ 4*b2^2*E2*S^2 + b1*E2*S^2 - b1^2*E2 - 4*b2*R*E2 +
	- b2^2*S^4 + b1^2*S^2 + 2*b2*R*S^2 - 2*b1*R*S")
p3 = toPoly.pm("- 3*E3^2 + 12*E2*E3*S - 6*E3*S^3 + 4*b2^2*E3*S + 2*b1*E3*S - 6*b1*b2*E3 +
	+ 2*E2^3 - 9*E2^2*S^2 + 2*b2^2*E2^2 + 4*b1*E2^2 +
	+ 6*E2*S^4 - 4*b2^2*E2*S^2 - 2*b1*E2*S^2 + 6*b1*b2*E2*S + 4*b2*R*E2 +
	- S^6 + b2^2*S^4 - 2*b1*b2*S^3 - 2*b2*R*S^2 - b1^2*S^2  + 2*b1*R*S + 3*R^2");
p3$coeff = - p3$coeff;
p3b = data.frame(
	E3 = c(2, 1, 1, 1, 1, 1,   0, 0, 0, 0,   0, 0, 0, 0, 0,   0, 0, 0, 0, 0, 0, 0),
	E2 = c(0, 1, 1, 0, 0, 0,   3, 2, 2, 2,   1, 1, 1, 1, 1,   0, 0, 0, 0, 0, 0, 0),
	S  = c(0, 1, 0, 3, 2, 0,   0, 2, 1, 0,   4, 2, 1, 0, 0,   6, 4, 3, 2, 2, 1, 0),
	b1 = c(0, 0, 0, 0, 0, 1,   0, 0, 0, 0,   0, 0, 1, 2, 0,   0, 0, 1, 2, 0, 1, 0),
	b2 = c(0, 0, 1, 0, 1, 1,   0, 0, 1, 2,   0, 2, 1, 0, 1,   0, 2, 1, 0, 1, 0, 0),
	R  = c(0, 0, 0, 0, 0, 0,   0, 0, 0, 0,   0, 0, 0, 0, 1,   0, 0, 0, 0, 1, 1, 2),
	coeff = c(3,-12,-2,6,-4,6,  -2, 9, 2, 4,  -6,-4,-6, 2, 4,  1, 1, 2,-1,-2, 2,-3)
)
# TODO:
diff.pm(p3, p3b)
# Debug
eval.pm(p2, c(E3, E2, S, b1, b2, R))
eval.pm(p3, c(E3, E2, S, b1, b2, R))

### Solve:
p2r = replace.fr.pm(p2, p1, 3, "E3", 1)
p2r$coeff = - p2r$coeff;
p2r = sort.pm(p2r, c(4,5,3), xn=c("E2","S"))

p3r = replace.fr.pm(p3, p1, 3, "E3", 1)
p3r$coeff = - p3r$coeff / 6;
p3r = sort.pm(p3r, c(4,5,3), xn=c("E2","S"))

7*b2^2*E2^2 + 6*b1*E2^2 - 5*S^3*b2*E2 - 9*S^2*b2^2*E2 + 4*S*b2^3*E2 + 3*S*b1*b2*E2 + 3*b1^2*E2 + 9*b2*R*E2 +
	+ 2*S^5*b2 + 3*S^4*b2^2 - S^4*b1 - 2*S^3*b2^3 + S^3*b1*b2 - 2*S^2*b1*b2^2 - 4*S^2*b1^2 +
	- 12*S^2*b2*R + 6*S*b2^2*R + 9*S*b1*R

3*E2^3 + 6*S*b2*E2^2 - 6*b2^2*E2^2 - 3*S^4*E2 - 2*S^3*b2*E2 - 3*S^2*b1*E2 + 11*S^2*b2^2*E2 +
	+ S*b1*b2*E2 + 9*S*R*E2 - 3*b1^2*E2 - 6*b1*b2^2*E2 - 9*b2*R*E2 +
	+ S^6 + 2*S^4*b1 - 4*S^4*b2^2 - 3*S^3*b1*b2 - 6*S^3*R +
	+ S^2*b1^2 + 3*S^2*b1*b2^2 + 12*S^2*b2*R + 3*S*b1^2*b2 - 9*b1*b2*R

pS = solve.pm(p2r, p3r, "E2")

library(gmp)
pSr = pS[[1]]; pSr$coeff = as.bigz(pSr$coeff);
pDiv = data.frame(
	S=c(3,2,1,0), b2=c(0,1,0,0), b1=c(0,0,1,0), R=c(0,0,0,1),
	coeff=c(1, 3, 9, -27));
pDivInt = pDiv;
pDiv$coeff = as.bigz(pDiv$coeff);
pSd = div.bigpm(pSr, pDiv, by="S")
pSd = pSd[[1]];

pSd$coeff = - as.numeric(pSd$coeff)
pSd = sort.pm(pSd, c(4,3), xn=c("S"))
pSd
eval.pm(pSd, c(S, b1, b2, R))
# toCoeff(pSd, "S")

### True Solutions
### P[12] = P[4] * P[8];
b2^3*S^4 - b2^2*(3*b1 - 2*b2^2)*S^3 - 3*b1*b2^3*S^2 +
	+ (3*b1^3 + 3*b1^2*b2^2 - 6*b2^3*R + 4*b1*b2^4)*S +
	- 3*b1^3*b2 + 9*b1*b2^2*R - 7*b1^2*b2^3
p4non = data.frame(
	S  = c(4, 3, 3, 2,   1, 1, 1, 1,   0, 0, 0),
	b1 = c(0, 1, 0, 1,   3, 2, 0, 1,   3, 1, 2),
	b2 = c(3, 2, 4, 3,   0, 2, 3, 4,   1, 2, 3),
	R  = c(0, 0, 0, 0,   0, 0, 1, 0,   0, 1, 0),
	coeff = c(1,-3, 2,-3,  3, 3,-6, 4,  -3, 9,-7)
)
### The True Solutions:
pSd2 = div.pm(pSd, p4non, by="S")$Rez;
pSd2 = div.pm(pSd2, data.frame(b1=c(2,1,0), b2=c(0,2,4), coeff=c(108,252,147)), by="b2")$Rez;
pSd2 = sort.pm(pSd2, c(4,3), xn=c("S"))
# cat(paste(toCoeff(pSd2, "S"), sep="", collapse=",\n")); cat("\n");


### Auxiliary Eqs:
pE2x = pS[[2]];
pE2x$coeff = as.numeric(pE2x$coeff)
pE2x = sort.pm(pE2x, c(4,3), xn=c("S"))
# cat(paste(toCoeff(pE2x, "S"), sep="", collapse=",\n")); cat("\n");

pE2Div = pS[[3]];
pE2Div$coeff = as.numeric(pE2Div$coeff)
pE2Div = sort.pm(pE2Div, c(4,3), xn=c("S"))
# cat(paste(toCoeff(pE2Div, "S"), sep="", collapse=",\n")); cat("\n");

### Test:
x^3 + b2*y^2 + b1*z # - R
y^3 + b2*z^2 + b1*x # - R
z^3 + b2*x^2 + b1*y # - R

### Debug:
R = 3; b = c(2,-1);
b1 = b[1]; b2 = b[2];
x = -1.6372723783 + 0.4783895464i;
y = -1.0979358419 - 1.8696543548i;
z =  1.9873630466 + 0.1839016351i;
S = x+y+z; E2 = x*y+x*z+y*z; E3 = x*y*z;


