
########################
###
### Leonard Mada
### [the one and only]
###
### Polynomial Systems: S3
### Symmetric Variants
###
### draft v.0.1c


### Polynomial Systems: 3 Variables
### Symmetric Variants

### Simple Entanglements

### Examples:
x^n + y^n + z^n = R1
(x*y + x*z + y*z) {*,/} (x + y + z) = R2
x*y*z {*,/} (x + y + z)^k = R3

### Ex 2:
x^n + y^n + z^n = R1
(x*y + x*z + y*z) * x*y*z = R2


####################

###############
### History ###

### draft v.0.1b - v.0.1c:
# - another simple entangled system:
#   E2*E3 = R2;
#   E3*S = R3;
# - extension:
#   x*y*z * S + b3*S = R3;
# - example: 4/3 + 2*x + 5*x^2 - 5*x^3 + x^6;
### draft v.0.1a:
# - variants of the S3 symmetric systems:
#   S3 = 3 variables;
# - for the simple symmetric S3 systems, see:
#   Math.Poly.SystemP3_Full.R;
# - TODO: rename the file: Math.Poly.SystemP3_Full.R;


################

################
### Introduction

# TODO

####################
####################

### helper functions

library(polynom)
library(pracma)

# the functions are in the file:
# Polynomials.Helper.R


################################
################################


###############
### Order 2 ###

# x^2 + y^2 + z^2 = R1
# (x*y + x*z + y*z) / (x + y +z) = R2
# x*y*z * (x + y + z)^k = R3

solve.S3P2 = function(R, b, k=1, type="M") {
	S = roots(c(1, b[1] - 2*R[2], -R[1]))
	E2 = R[2] * S;
	if(type == "M") {
		E3 = R[3] / S^k;
	} else {
		E3 = R[3] * sapply(S, function(S) sum(S^k)); # more than 1 powers
	}
	x = sapply(seq_along(S), function(id) roots(c(1, -S[id], E2[id], -E3[id])))
	sol = solve.EnAll(x, n=3)
	return(sol)
}

###
R = c(1,0,-1)
b = 2;
k = 1;
sol = solve.S3P2(R, b, k=k)
x = sol[,1]; y = sol[,2]; z = sol[,3];

### Test:
x^2 + y^2 + z^2 + b[1]*(x + y + z) # - R1
(x*y + x*z + y*z) / (x + y +z) # - R2
x*y*z * (x + y + z)^k # - R3

poly.calc(sol[c(1,2,4,7,8,10),1])


###
R = c(1,0,-1)
b = -3;
k = 2;
sol = solve.S3P2(R, b, k=k, type="D")
x = sol[,1]; y = sol[,2]; z = sol[,3];

### Test:
x^2 + y^2 + z^2 + b[1]*(x + y + z) # - R1
(x*y + x*z + y*z) / (x + y +z) # - R2
x*y*z / (x + y + z)^k # - R3

poly.calc(sol[c(1,2,4,7,8,10),1])


###
R = c(-1,1,1)
b = 1;
k = 3;
sol = solve.S3P2(R, b, k=k, type="D")
x = sol[,1]; y = sol[,2]; z = sol[,3];

### Test:
x^2 + y^2 + z^2 + b[1]*(x + y + z) # - R1
(x*y + x*z + y*z) / (x + y +z) # - R2
x*y*z / (x + y + z)^k # - R3

poly.calc(sol[c(1,2,4,7,8,10),1])
1 + x + 2*x^4 - x^5 + x^6


### Classic Polynomial:

### TODO:
# - needs workup & cleaning;

(R1^2*R2^4*R3^7) +
(- 2*R1^2*R2^3*R3^7 - 7*R1^2*R2^5*R3^6)*x^1 +
(3*R1^2*R2^2*R3^7 + 21*R1^2*R2^4*R3^6 + 21*R1^2*R2^6*R3^5)*x^2 +
(- 2*R1*R2^4*R3^6*b1 + 4*R1*R2^5*R3^6 - 2*R1^2*R2*R3^7 - 35*R1^2*R2^3*R3^6 - 84*R1^2*R2^5*R3^5 - 35*R1^2*R2^7*R3^4)*x^3 +
(4*R1*R2^3*R3^6*b1 - 8*R1*R2^4*R3^6 + 12*R1*R2^5*R3^5*b1 - 24*R1*R2^6*R3^5 + 35*R1^2*R2^2*R3^6 + 168*R1^2*R2^4*R3^5 + 175*R1^2*R2^6*R3^4 + 35*R1^2*R2^8*R3^3 + R1^2*R3^7)*x^4 +
(- 6*R1*R2^2*R3^6*b1 + 12*R1*R2^3*R3^6 - 36*R1*R2^4*R3^5*b1 + 72*R1*R2^5*R3^5 - 30*R1*R2^6*R3^4*b1 + 60*R1*R2^7*R3^4 - 21*R1^2*R2*R3^6 - 210*R1^2*R2^3*R3^5 - 420*R1^2*R2^5*R3^4 - 210*R1^2*R2^7*R3^3 - 21*R1^2*R2^9*R3^2)*x^5 +
(4*R1*R2*R3^6*b1 - 8*R1*R2^2*R3^6 + 60*R1*R2^3*R3^5*b1 - 122*R1*R2^4*R3^5 + 120*R1*R2^5*R3^4*b1 - 240*R1*R2^6*R3^4 + 40*R1*R2^7*R3^3*b1 - 80*R1*R2^8*R3^3 + 168*R1^2*R2^2*R3^5 + 630*R1^2*R2^4*R3^4 + 595*R1^2*R2^6*R3^3 + 147*R1^2*R2^8*R3^2 + 7*R1^2*R2^10*R3 + 7*R1^2*R3^6 + R2^4*R3^5*b1^2 - 4*R2^5*R3^5*b1 + 4*R2^6*R3^5)*x^6 +
(4*R1*R2*R3^6 - 60*R1*R2^2*R3^5*b1 + 124*R1*R2^3*R3^5 - 240*R1*R2^4*R3^4*b1 + 490*R1*R2^5*R3^4 - 200*R1*R2^6*R3^3*b1 + 400*R1*R2^7*R3^3 - 30*R1*R2^8*R3^2*b1 + 60*R1*R2^9*R3^2 - 2*R1*R3^6*b1 - 84*R1^2*R2*R3^5 - 630*R1^2*R2^3*R3^4 - 1050*R1^2*R2^5*R3^3 - 483*R1^2*R2^7*R3^2 - 56*R1^2*R2^9*R3 - R1^2*R2^11 - 2*R2^3*R3^5*b1^2 + 8*R2^4*R3^5*b1 - 5*R2^5*R3^4*b1^2 - 8*R2^5*R3^5 + 20*R2^6*R3^4*b1 - 20*R2^7*R3^4)*x^7 +
(36*R1*R2*R3^5*b1 - 78*R1*R2^2*R3^5 + 300*R1*R2^3*R3^4*b1 - 630*R1*R2^4*R3^4 + 480*R1*R2^5*R3^3*b1 - 980*R1*R2^6*R3^3 + 180*R1*R2^7*R3^2*b1 - 360*R1*R2^8*R3^2 + 12*R1*R2^9*R3*b1 - 24*R1*R2^10*R3 + 420*R1^2*R2^2*R3^4 + 1260*R1^2*R2^4*R3^3 + 987*R1^2*R2^6*R3^2 + 210*R1^2*R2^8*R3 + 9*R1^2*R2^10 + 21*R1^2*R3^5 + 3*R2^2*R3^5*b1^2 - 12*R2^3*R3^5*b1 + 15*R2^4*R3^4*b1^2 + 12*R2^4*R3^5 - 60*R2^5*R3^4*b1 + 10*R2^6*R3^3*b1^2 + 60*R2^6*R3^4 - 40*R2^7*R3^3*b1 + 40*R2^8*R3^3)*x^8 +
(28*R1*R2*R3^5 - 240*R1*R2^2*R3^4*b1 + 530*R1*R2^3*R3^4 - 720*R1*R2^4*R3^3*b1 + 1520*R1*R2^5*R3^3 - 510*R1*R2^6*R3^2*b1 + 1040*R1*R2^7*R3^2 - 84*R1*R2^8*R3*b1 + 168*R1*R2^9*R3 - 2*R1*R2^10*b1 + 4*R1*R2^11 - 12*R1*R3^5*b1 - 175*R1^2*R2*R3^4 - 1050*R1^2*R2^3*R3^3 - 1386*R1^2*R2^5*R3^2 - 490*R1^2*R2^7*R3 - 38*R1^2*R2^9 - 2*R2*R3^5*b1^2 + 8*R2^2*R3^5*b1 - 25*R2^3*R3^4*b1^2 - 8*R2^3*R3^5 + 102*R2^4*R3^4*b1 - 40*R2^5*R3^3*b1^2 - 104*R2^5*R3^4 + 160*R2^6*R3^3*b1 - 10*R2^7*R3^2*b1^2 - 160*R2^7*R3^3 + 40*R2^8*R3^2*b1 - 40*R2^9*R3^2)*x^9 +
(120*R1*R2*R3^4*b1 - 290*R1*R2^2*R3^4 + 720*R1*R2^3*R3^3*b1 - 1600*R1*R2^4*R3^3 + 900*R1*R2^5*R3^2*b1 - 1900*R1*R2^6*R3^2 + 276*R1*R2^7*R3*b1 - 562*R1*R2^8*R3 + 16*R1*R2^9*b1 - 32*R1*R2^10 - 2*R1*R3^5 + 595*R1^2*R2^2*R3^3 + 1386*R1^2*R2^4*R3^2 + 791*R1^2*R2^6*R3 + 100*R1^2*R2^8 + 35*R1^2*R3^4 - 4*R2*R3^5*b1 + 25*R2^2*R3^4*b1^2 + 4*R2^2*R3^5 - 104*R2^3*R3^4*b1 + 80*R2^4*R3^3*b1^2 + 108*R2^4*R3^4 - 328*R2^5*R3^3*b1 + 50*R2^6*R3^2*b1^2 + 336*R2^6*R3^3 - 200*R2^7*R3^2*b1 + 5*R2^8*R3*b1^2 + 200*R2^8*R3^2 - 20*R2^9*R3*b1 + 20*R2^10*R3 + R3^5*b1^2)*x^10 +
(90*R1*R2*R3^4 - 480*R1*R2^2*R3^3*b1 + 1160*R1*R2^3*R3^3 - 1080*R1*R2^4*R3^2*b1 + 2400*R1*R2^5*R3^2 - 564*R1*R2^6*R3*b1 + 1188*R1*R2^7*R3 - 60*R1*R2^8*b1 + 122*R1*R2^9 - 30*R1*R3^4*b1 - 210*R1^2*R2*R3^3 - 987*R1^2*R2^3*R3^2 - 924*R1^2*R2^5*R3 - 183*R1^2*R2^7 - 15*R2*R3^4*b1^2 + 66*R2^2*R3^4*b1 - 100*R2^3*R3^3*b1^2 - 72*R2^3*R3^4 + 424*R2^4*R3^3*b1 - 120*R2^5*R3^2*b1^2 - 448*R2^5*R3^3 + 492*R2^6*R3^2*b1 - 30*R2^7*R3*b1^2 - 504*R2^7*R3^2 + 120*R2^8*R3*b1 - 120*R2^9*R3 - R2^9*b1^2 + 4*R2^10*b1 - 4*R2^11)*x^11 +
(200*R1*R2*R3^3*b1 - 560*R1*R2^2*R3^3 + 900*R1*R2^3*R3^2*b1 - 2160*R1*R2^4*R3^2 + 792*R1*R2^5*R3*b1 - 1754*R1*R2^6*R3 + 140*R1*R2^7*b1 - 294*R1*R2^8 - 10*R1*R3^4 + 483*R1^2*R2^2*R3^2 + 791*R1^2*R2^4*R3 + 245*R1^2*R2^6 + 35*R1^2*R3^3 - 24*R2*R3^4*b1 + 80*R2^2*R3^3*b1^2 + 28*R2^2*R3^4 - 360*R2^3*R3^3*b1 + 180*R2^4*R3^2*b1^2 + 401*R2^4*R3^3 - 768*R2^5*R3^2*b1 + 85*R2^6*R3*b1^2 + 816*R2^6*R3^2 - 348*R2^7*R3*b1 + 356*R2^8*R3 + 7*R2^8*b1^2 - 28*R2^9*b1 + 28*R2^10 + 5*R3^4*b1^2)*x^12 +
(160*R1*R2*R3^3 - 510*R1*R2^2*R3^2*b1 + 1380*R1*R2^3*R3^2 - 792*R1*R2^4*R3*b1 + 1884*R1*R2^5*R3 - 226*R1*R2^6*b1 + 498*R1*R2^7 - 40*R1*R3^3*b1 - 147*R1^2*R2*R3^2 - 490*R1^2*R2^3*R3 - 245*R1^2*R2^5 - 40*R2*R3^3*b1^2 - 4*R2*R3^4 + 200*R2^2*R3^3*b1 - 180*R2^3*R3^2*b1^2 - 242*R2^3*R3^3 + 816*R2^4*R3^2*b1 - 150*R2^5*R3*b1^2 - 915*R2^5*R3^2 + 640*R2^6*R3*b1 - 680*R2^7*R3 - 23*R2^7*b1^2 + 94*R2^8*b1 - 96*R2^9 + 2*R3^4*b1)*x^13 +
(180*R1*R2*R3^2*b1 - 600*R1*R2^2*R3^2 + 564*R1*R2^3*R3*b1 - 1488*R1*R2^4*R3 + 264*R1*R2^5*b1 - 622*R1*R2^6 - 20*R1*R3^3 + 210*R1^2*R2^2*R3 + 183*R1^2*R2^4 + 21*R1^2*R3^2 - 64*R2*R3^3*b1 + 120*R2^2*R3^2*b1^2 + 91*R2^2*R3^3 - 600*R2^3*R3^2*b1 + 180*R2^4*R3*b1^2 + 729*R2^4*R3^2 - 816*R2^5*R3*b1 + 915*R2^6*R3 + 47*R2^6*b1^2 - 200*R2^7*b1 + 212*R2^8 + 10*R3^3*b1^2)*x^14 +
(160*R1*R2*R3^2 - 276*R1*R2^2*R3*b1 + 852*R1*R2^3*R3 - 226*R1*R2^4*b1 + 584*R1*R2^5 - 30*R1*R3^2*b1 - 56*R1^2*R2*R3 - 100*R1^2*R2^3 - 50*R2*R3^2*b1^2 - 18*R2*R3^3 + 296*R2^2*R3^2*b1 - 150*R2^3*R3*b1^2 - 407*R2^3*R3^2 + 744*R2^4*R3*b1 - 900*R2^5*R3 - 66*R2^5*b1^2 + 298*R2^6*b1 - 333*R2^7 + 8*R3^3*b1)*x^15 +
(84*R1*R2*R3*b1 - 338*R1*R2^2*R3 + 140*R1*R2^3*b1 - 412*R1*R2^4 - 20*R1*R3^2 + 38*R1^2*R2^2 + 7*R1^2*R3 - 88*R2*R3^2*b1 + 85*R2^2*R3*b1^2 + 151*R2^2*R3^2 - 484*R2^3*R3*b1 + 652*R2^4*R3 + 66*R2^4*b1^2 - 324*R2^5*b1 + 389*R2^6 + 10*R3^2*b1^2 + R3^3)*x^16 +
(84*R1*R2*R3 - 60*R1*R2^2*b1 + 214*R1*R2^3 - 12*R1*R3*b1 - 9*R1^2*R2 - 30*R2*R3*b1^2 - 33*R2*R3^2 + 216*R2^2*R3*b1 - 342*R2^3*R3 - 47*R2^3*b1^2 + 260*R2^4*b1 - 344*R2^5 + 12*R3^2*b1)*x^17 +
(16*R1*R2*b1 - 78*R1*R2^2 - 10*R1*R3 + R1^2 - 60*R2*R3*b1 + 124*R2^2*R3 + 23*R2^2*b1^2 - 152*R2^3*b1 + 230*R2^4 + 5*R3*b1^2 + 3*R3^2)*x^18 +
(18*R1*R2 - 2*R1*b1 - 28*R2*R3 - 7*R2*b1^2 + 62*R2^2*b1 - 114*R2^3 + 8*R3*b1)*x^19 +
(- 2*R1 - 16*R2*b1 + 40*R2^2 + 3*R3 + b1^2)*x^20 +
(- 9*R2 + 2*b1)*x^21 +
(1)*x^22

coeff = c(
	(R1^2*R2^4*R3^7),
	(- 2*R1^2*R2^3*R3^7 - 7*R1^2*R2^5*R3^6),
	(3*R1^2*R2^2*R3^7 + 21*R1^2*R2^4*R3^6 + 21*R1^2*R2^6*R3^5),
	(- 2*R1*R2^4*R3^6*b1 + 4*R1*R2^5*R3^6 - 2*R1^2*R2*R3^7 - 35*R1^2*R2^3*R3^6 - 84*R1^2*R2^5*R3^5 +
		- 35*R1^2*R2^7*R3^4),
	(4*R1*R2^3*R3^6*b1 - 8*R1*R2^4*R3^6 + 12*R1*R2^5*R3^5*b1 - 24*R1*R2^6*R3^5 + 35*R1^2*R2^2*R3^6 +
		168*R1^2*R2^4*R3^5 + 175*R1^2*R2^6*R3^4 + 35*R1^2*R2^8*R3^3 + R1^2*R3^7),
	(- 6*R1*R2^2*R3^6*b1 + 12*R1*R2^3*R3^6 - 36*R1*R2^4*R3^5*b1 + 72*R1*R2^5*R3^5 - 30*R1*R2^6*R3^4*b1 +
		60*R1*R2^7*R3^4 - 21*R1^2*R2*R3^6 - 210*R1^2*R2^3*R3^5 - 420*R1^2*R2^5*R3^4 - 210*R1^2*R2^7*R3^3 +
		- 21*R1^2*R2^9*R3^2),
	(4*R1*R2*R3^6*b1 - 8*R1*R2^2*R3^6 + 60*R1*R2^3*R3^5*b1 - 122*R1*R2^4*R3^5 + 120*R1*R2^5*R3^4*b1 +
		- 240*R1*R2^6*R3^4 + 40*R1*R2^7*R3^3*b1 - 80*R1*R2^8*R3^3 + 168*R1^2*R2^2*R3^5 + 630*R1^2*R2^4*R3^4 +
		595*R1^2*R2^6*R3^3 + 147*R1^2*R2^8*R3^2 + 7*R1^2*R2^10*R3 + 7*R1^2*R3^6 + R2^4*R3^5*b1^2 +
		- 4*R2^5*R3^5*b1 + 4*R2^6*R3^5),
	(4*R1*R2*R3^6 - 60*R1*R2^2*R3^5*b1 + 124*R1*R2^3*R3^5 - 240*R1*R2^4*R3^4*b1 + 490*R1*R2^5*R3^4 +
		- 200*R1*R2^6*R3^3*b1 + 400*R1*R2^7*R3^3 - 30*R1*R2^8*R3^2*b1 + 60*R1*R2^9*R3^2 - 2*R1*R3^6*b1 +
		- 84*R1^2*R2*R3^5 - 630*R1^2*R2^3*R3^4 - 1050*R1^2*R2^5*R3^3 - 483*R1^2*R2^7*R3^2 +
		- 56*R1^2*R2^9*R3 - R1^2*R2^11 - 2*R2^3*R3^5*b1^2 + 8*R2^4*R3^5*b1 - 5*R2^5*R3^4*b1^2 +
		- 8*R2^5*R3^5 + 20*R2^6*R3^4*b1 - 20*R2^7*R3^4)
	(36*R1*R2*R3^5*b1 - 78*R1*R2^2*R3^5 + 300*R1*R2^3*R3^4*b1 - 630*R1*R2^4*R3^4 + 480*R1*R2^5*R3^3*b1 +
		- 980*R1*R2^6*R3^3 + 180*R1*R2^7*R3^2*b1 - 360*R1*R2^8*R3^2 + 12*R1*R2^9*R3*b1 - 24*R1*R2^10*R3 +
		420*R1^2*R2^2*R3^4 + 1260*R1^2*R2^4*R3^3 + 987*R1^2*R2^6*R3^2 + 210*R1^2*R2^8*R3 + 9*R1^2*R2^10 +
		21*R1^2*R3^5 + 3*R2^2*R3^5*b1^2 - 12*R2^3*R3^5*b1 + 15*R2^4*R3^4*b1^2 + 12*R2^4*R3^5 +
		- 60*R2^5*R3^4*b1 + 10*R2^6*R3^3*b1^2 + 60*R2^6*R3^4 - 40*R2^7*R3^3*b1 + 40*R2^8*R3^3),
	(28*R1*R2*R3^5 - 240*R1*R2^2*R3^4*b1 + 530*R1*R2^3*R3^4 - 720*R1*R2^4*R3^3*b1 + 1520*R1*R2^5*R3^3 +
		- 510*R1*R2^6*R3^2*b1 + 1040*R1*R2^7*R3^2 - 84*R1*R2^8*R3*b1 + 168*R1*R2^9*R3 - 2*R1*R2^10*b1 +
		4*R1*R2^11 - 12*R1*R3^5*b1 - 175*R1^2*R2*R3^4 - 1050*R1^2*R2^3*R3^3 - 1386*R1^2*R2^5*R3^2 +
		- 490*R1^2*R2^7*R3 - 38*R1^2*R2^9 - 2*R2*R3^5*b1^2 + 8*R2^2*R3^5*b1 - 25*R2^3*R3^4*b1^2 +
		- 8*R2^3*R3^5 + 102*R2^4*R3^4*b1 - 40*R2^5*R3^3*b1^2 - 104*R2^5*R3^4 + 160*R2^6*R3^3*b1 +
		- 10*R2^7*R3^2*b1^2 - 160*R2^7*R3^3 + 40*R2^8*R3^2*b1 - 40*R2^9*R3^2),
	(120*R1*R2*R3^4*b1 - 290*R1*R2^2*R3^4 + 720*R1*R2^3*R3^3*b1 - 1600*R1*R2^4*R3^3 + 900*R1*R2^5*R3^2*b1 +
		- 1900*R1*R2^6*R3^2 + 276*R1*R2^7*R3*b1 - 562*R1*R2^8*R3 + 16*R1*R2^9*b1 - 32*R1*R2^10 - 2*R1*R3^5 +
		595*R1^2*R2^2*R3^3 + 1386*R1^2*R2^4*R3^2 + 791*R1^2*R2^6*R3 + 100*R1^2*R2^8 + 35*R1^2*R3^4 +
		- 4*R2*R3^5*b1 + 25*R2^2*R3^4*b1^2 + 4*R2^2*R3^5 - 104*R2^3*R3^4*b1 + 80*R2^4*R3^3*b1^2 +
		108*R2^4*R3^4 - 328*R2^5*R3^3*b1 + 50*R2^6*R3^2*b1^2 + 336*R2^6*R3^3 - 200*R2^7*R3^2*b1 +
		5*R2^8*R3*b1^2 + 200*R2^8*R3^2 - 20*R2^9*R3*b1 + 20*R2^10*R3 + R3^5*b1^2),
	(90*R1*R2*R3^4 - 480*R1*R2^2*R3^3*b1 + 1160*R1*R2^3*R3^3 - 1080*R1*R2^4*R3^2*b1 + 2400*R1*R2^5*R3^2 +
		- 564*R1*R2^6*R3*b1 + 1188*R1*R2^7*R3 - 60*R1*R2^8*b1 + 122*R1*R2^9 - 30*R1*R3^4*b1 +
		- 210*R1^2*R2*R3^3 - 987*R1^2*R2^3*R3^2 - 924*R1^2*R2^5*R3 - 183*R1^2*R2^7 - 15*R2*R3^4*b1^2 +
		66*R2^2*R3^4*b1 - 100*R2^3*R3^3*b1^2 - 72*R2^3*R3^4 + 424*R2^4*R3^3*b1 - 120*R2^5*R3^2*b1^2 +
		- 448*R2^5*R3^3 + 492*R2^6*R3^2*b1 - 30*R2^7*R3*b1^2 - 504*R2^7*R3^2 + 120*R2^8*R3*b1 +
		- 120*R2^9*R3 - R2^9*b1^2 + 4*R2^10*b1 - 4*R2^11),
	(200*R1*R2*R3^3*b1 - 560*R1*R2^2*R3^3 + 900*R1*R2^3*R3^2*b1 - 2160*R1*R2^4*R3^2 + 792*R1*R2^5*R3*b1 +
		- 1754*R1*R2^6*R3 + 140*R1*R2^7*b1 - 294*R1*R2^8 - 10*R1*R3^4 + 483*R1^2*R2^2*R3^2 +
		791*R1^2*R2^4*R3 + 245*R1^2*R2^6 + 35*R1^2*R3^3 - 24*R2*R3^4*b1 + 80*R2^2*R3^3*b1^2 +
		28*R2^2*R3^4 - 360*R2^3*R3^3*b1 + 180*R2^4*R3^2*b1^2 + 401*R2^4*R3^3 - 768*R2^5*R3^2*b1 +
		85*R2^6*R3*b1^2 + 816*R2^6*R3^2 - 348*R2^7*R3*b1 + 356*R2^8*R3 + 7*R2^8*b1^2 - 28*R2^9*b1 +
		28*R2^10 + 5*R3^4*b1^2),
	(160*R1*R2*R3^3 - 510*R1*R2^2*R3^2*b1 + 1380*R1*R2^3*R3^2 - 792*R1*R2^4*R3*b1 + 1884*R1*R2^5*R3 +
		- 226*R1*R2^6*b1 + 498*R1*R2^7 - 40*R1*R3^3*b1 - 147*R1^2*R2*R3^2 - 490*R1^2*R2^3*R3 +
		- 245*R1^2*R2^5 - 40*R2*R3^3*b1^2 - 4*R2*R3^4 + 200*R2^2*R3^3*b1 - 180*R2^3*R3^2*b1^2 +
		- 242*R2^3*R3^3 + 816*R2^4*R3^2*b1 - 150*R2^5*R3*b1^2 - 915*R2^5*R3^2 + 640*R2^6*R3*b1 +
		- 680*R2^7*R3 - 23*R2^7*b1^2 + 94*R2^8*b1 - 96*R2^9 + 2*R3^4*b1),
	(180*R1*R2*R3^2*b1 - 600*R1*R2^2*R3^2 + 564*R1*R2^3*R3*b1 - 1488*R1*R2^4*R3 + 264*R1*R2^5*b1 +
		- 622*R1*R2^6 - 20*R1*R3^3 + 210*R1^2*R2^2*R3 + 183*R1^2*R2^4 + 21*R1^2*R3^2 - 64*R2*R3^3*b1 +
		120*R2^2*R3^2*b1^2 + 91*R2^2*R3^3 - 600*R2^3*R3^2*b1 + 180*R2^4*R3*b1^2 + 729*R2^4*R3^2 +
		- 816*R2^5*R3*b1 + 915*R2^6*R3 + 47*R2^6*b1^2 - 200*R2^7*b1 + 212*R2^8 + 10*R3^3*b1^2),
	(160*R1*R2*R3^2 - 276*R1*R2^2*R3*b1 + 852*R1*R2^3*R3 - 226*R1*R2^4*b1 + 584*R1*R2^5 - 30*R1*R3^2*b1 +
		- 56*R1^2*R2*R3 - 100*R1^2*R2^3 - 50*R2*R3^2*b1^2 - 18*R2*R3^3 + 296*R2^2*R3^2*b1 +
		- 150*R2^3*R3*b1^2 - 407*R2^3*R3^2 + 744*R2^4*R3*b1 - 900*R2^5*R3 - 66*R2^5*b1^2 +
		298*R2^6*b1 - 333*R2^7 + 8*R3^3*b1),
(84*R1*R2*R3*b1 - 338*R1*R2^2*R3 + 140*R1*R2^3*b1 - 412*R1*R2^4 - 20*R1*R3^2 + 38*R1^2*R2^2 + 7*R1^2*R3 - 88*R2*R3^2*b1 + 85*R2^2*R3*b1^2 + 151*R2^2*R3^2 - 484*R2^3*R3*b1 + 652*R2^4*R3 + 66*R2^4*b1^2 - 324*R2^5*b1 + 389*R2^6 + 10*R3^2*b1^2 + R3^3)*x^16 +
(84*R1*R2*R3 - 60*R1*R2^2*b1 + 214*R1*R2^3 - 12*R1*R3*b1 - 9*R1^2*R2 - 30*R2*R3*b1^2 - 33*R2*R3^2 + 216*R2^2*R3*b1 - 342*R2^3*R3 - 47*R2^3*b1^2 + 260*R2^4*b1 - 344*R2^5 + 12*R3^2*b1)*x^17 +
(16*R1*R2*b1 - 78*R1*R2^2 - 10*R1*R3 + R1^2 - 60*R2*R3*b1 + 124*R2^2*R3 + 23*R2^2*b1^2 - 152*R2^3*b1 + 230*R2^4 + 5*R3*b1^2 + 3*R3^2)*x^18 +
(18*R1*R2 - 2*R1*b1 - 28*R2*R3 - 7*R2*b1^2 + 62*R2^2*b1 - 114*R2^3 + 8*R3*b1)*x^19 +
(- 2*R1 - 16*R2*b1 + 40*R2^2 + 3*R3 + b1^2)*x^20 +
(- 9*R2 + 2*b1)*x^21 +
(1)*x^22
)

### z
zSubst = - 10*R1*R2*R3*x^5 - 7*R1*R2*R3^2*x^3 - 2*R1*R2*R3^3*x - 5*R1*R2*x^7 + 17*R1*R2^2*R3*x^4 + 9*R1*R2^2*R3^2*x^2 + R1*R2^2*R3^3 + 10*R1*R2^2*x^6 - 12*R1*R2^3*R3*x^3 - 3*R1*R2^3*R3^2*x - 10*R1*R2^3*x^5 + 3*R1*R2^4*R3*x^2 + 5*R1*R2^4*x^4 - R1*R2^5*x^3 + 2*R1*R3*x^6 + R1*R3^2*x^4 + R1*x^8 + 5*R2*R3*b1*x^6 + 4*R2*R3*x^7 + 2*R2*R3^2*b1*x^4 + 4*R2*b1*x^8 + 5*R2*x^9 - 6*R2^2*R3*b1*x^5 - 11*R2^2*R3*x^6 - R2^2*R3^2*b1*x^3 - 4*R2^2*R3^2*x^4 - 6*R2^2*b1*x^7 - 11*R2^2*x^8 + 2*R2^3*R3*b1*x^4 + 12*R2^3*R3*x^5 + 2*R2^3*R3^2*x^3 + 4*R2^3*b1*x^6 + 13*R2^3*x^7 - 4*R2^4*R3*x^4 - R2^4*b1*x^5 - 8*R2^4*x^6 + 2*R2^5*x^5 - R3*b1*x^7 - b1*x^9 - x^10;

zDiv = - 14*R1*R2*R3*x^4 - 9*R1*R2*R3^2*x^2 - 2*R1*R2*R3^3 - 7*R1*R2*x^6 + 15*R1*R2^2*R3*x^3 + 6*R1*R2^2*R3^2*x + 10*R1*R2^2*x^5 - 6*R1*R2^3*R3*x^2 - 7*R1*R2^3*x^4 + 2*R1*R2^4*x^3 + 5*R1*R3*x^5 + 4*R1*R3^2*x^3 + R1*R3^3*x + 2*R1*x^7 + 6*R2*R3*b1*x^5 + 8*R2*R3*x^6 + 2*R2*R3^2*b1*x^3 + 2*R2*R3^2*x^4 + 5*R2*b1*x^7 + 7*R2*x^8 - 4*R2^2*R3*b1*x^4 - 12*R2^2*R3*x^5 - 4*R2^2*R3^2*x^3 - 5*R2^2*b1*x^6 - 12*R2^2*x^7 + 8*R2^3*R3*x^4 + 2*R2^3*b1*x^5 + 10*R2^3*x^6 - 4*R2^4*x^5 - 3*R3*b1*x^6 - R3*x^7 - R3^2*b1*x^4 - 2*b1*x^8 - 2*x^9;


#####################
#####################

#################
### Entangled ###
### Order 2   ###

# x^2 + y^2 + z^2 = R1
# E2 * E3 = R2
# E3 * S = R3

### Solution:

### E2
R2/R3 * S

### =>
S^2 - 2*E2 - R1 # = 0
S^2 - 2*R2/R3*S - R1

### Solver:
solve.S3P2 = function(R, b=c(0,0,0), max.perm=1, debug=TRUE) {
	if(length(b) < 3) b = c(b, rep(0, 3 - length(b)))
	if(b[3] == 0) {
		coeff = c(1, b[1] - 2*R[2]/R[3], -R[1])
	} else {
		coeff = c(-b[3], R[3] - b[1]*b[3], b[1]*R[3] + b[3]*R[1] - 2*R[2], -R[1]*R[3]);
	}
	S = roots(coeff);
	if(debug) print(S);
	S = S[ S != 0]
	R1 = R[1] - b[1]*S;
	R2 = R[2] - b[2]*S;
	R3 = R[3] - b[3]*S;
	E2 = R2/R3 * S;
	E3 = R3/S;
	x = sapply(seq_along(S), function(id) roots(c(1, -S[id], E2[id], -E3[id])))
	sol = solve.EnAll(x, n=3, max.perm=max.perm)
	if(max.perm == 1) sol = rbind(sol, sol[,c(2,3,1)], sol[,c(3,1,2)])
	return(sol)
}

### Example:
R = c(1,-2,-1)
b = 0
sol = solve.S3P2(R)
x = sol[,1]; y = sol[,2]; z = sol[,3];

### Test
S = x+y+z;
x^2 + y^2 + z^2 + b[1]*S # - R[1]
(x*y+x*z+y*z) * x*y*z # - R[2]
x*y*z * S # - R[3]

### Classic Poly
round0.p(poly.calc(x))
err = -1 - 36*x + 14*x^2 + 7*x^4 - 4*x^5 + x^6
round0(err)


#########
### Ex 2:
R = c(1,-2,-1)
b = 5
sol = solve.S3P2(R, b=b)
x = sol[,1]; y = sol[,2]; z = sol[,3];

### Test
S = x+y+z;
x^2 + y^2 + z^2 + b[1]*S # - R[1]
(x*y+x*z+y*z) * x*y*z # - R[2]
x*y*z * S # - R[3]

### Classic Poly
round0.p(poly.calc(x))
err = -1 - 6*x - x^2 + 5*x^3 - 3*x^4 + x^5 + x^6
round0(err)


#########
### Ex 2:
R = c(0,-2,-1)
b = c(1,0,-1)
sol = solve.S3P2(R, b=b)
x = sol[,1]; y = sol[,2]; z = sol[,3];

### Test
S = x+y+z;
x^2 + y^2 + z^2 + b[1]*S # - R[1]
(x*y+x*z+y*z) * x*y*z # - R[2]
x*y*z * S + b[3]*S # - R[3]

### Classic Poly
round0.p(poly.calc(x))
err = 4/3 + 2*x + 5*x^2 - 5*x^3 + x^6
round0(err)

